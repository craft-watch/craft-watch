name: Build
on: [push]

# TODO - Gradle cache
# TODO - job for Run scraper
# TODO - test results / logs
# TODO - ensure new commit cancels active runs
# TODO - no gradle daemon

jobs:

  test_backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-java@v1
        with:
          java-version: 13.0.1

      - name: Create file for service key
        run: echo "${GCLOUD_SERVICE_KEY}" > "${GITHUB_WORKSPACE}/service-key.json"
        shell: bash
        env:
          GCLOUD_SERVICE_KEY: ${{ secrets.GCLOUD_SERVICE_KEY }}

      - name: Run tests
        run: ./gradlew check -i
        env:
          GOOGLE_APPLICATION_CREDENTIALS: "${GITHUB_WORKSPACE}/service-key.json"

